<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes,forceCommunity:availableForAllPageTypes" 
                access="global" 
                controller="ProductDetailCC">
  	
    <aura:attribute name="res" type="String" />
    <aura:attribute name="asset" type="Asset" />
    <aura:attribute name="assetImageURL" type="String" />
    <aura:attribute name="assetProductCode" type="String" />
    <aura:attribute name="individualAssetList" type="Asset[]" /> 
   
    <!--aura:attribute name="allSerialHelpers" type="SerialNumberDisplayType__c[]" /-->
    <!--aura:attribute name="mapSerialHelpers" type="Map" default="{ a: 'label1'}"/-->
    <!--aura:attribute name="myObjects" type="namespace.MyObj__c[]"/-->
    
    <aura:attribute name="locationList" type="String[]" />
	<aura:attribute name="showError" type="Boolean" required="true" description="" default="false" access="private"/>
    <aura:attribute name="errorMessage" type="String" required="false" description="" access="private"/>

    
    <!-- for component variables -->
    <aura:attribute name="serialNoP" type="String"/>
    <aura:attribute name="purchaseDateP" type="String"/>
    <aura:attribute name="purchaseDateK" type="String"/>
    <aura:attribute name="locationP" type="String"/>
    <aura:attribute name="locationK" type="String"/>
    <aura:attribute name="locationHolderP" type="String"/>
    <aura:attribute name="locationHolderK" type="String"/>
    <aura:attribute name="isBunningReceipt" type="String" default="Yes"/>
    <aura:attribute name="hasFile" type="Boolean" default="false" />
    <aura:attribute name="warrantyResult" type="String"/>
   
    <aura:attribute name="serialWeek" type="String"/>
    <aura:attribute name="xserialWeek" type="String"/>
    
    <aura:attribute name="serialYear" type="String"/>
    <aura:attribute name="showSerialWeek" type="Boolean" default="false" />
    <aura:attribute name="showSerialYear" type="Boolean" default="false" />
    <aura:attribute name="allowNumbersOnly" type="Boolean" default="false"/>
    <aura:attribute name="serialNumberLength" type="String" default="2"/>
    <aura:attribute name="regExpressionValidator" type="String"/>
    <aura:attribute name="serialHelpText" type="String"/>
    <aura:attribute name="serialHelpImage" type="String"/>
    
    <aura:attribute name="assetmap" type="Map"/>
    
   
    
    <aura:attribute name="siteSettings" type="Community_Settings__c"/>
    
    <!-- for receiving navigation event from the selection page -->
  	<aura:handler event="c:WarrantyProductSelectionEvent" action="{!c.handleNavigateFromSelectionEvent}"/>
    
    <!-- for navigating to product selection page after confirmation -->
	<aura:registerEvent name="navigate" type="c:ProductDetailConfirmEvent"/>
    
    <ltng:require scripts="{!join(',', 
								$Resource.jquery,
                           		$Resource.select2 + '/select2/js/select2.full.min.js',
								$Resource.DisableBackButton
                           		)
                           }" 
                  styles="{!join(',',
                                $Resource.select2 + '/select2/css/select2.min.css'
                          		)
                          }"
                  afterScriptsLoaded="c.afterScriptsLoaded"/>
    
    
    
    <div id="promptDiv"  style="display: none;" >
        <div tabindex="-1" aria-labelledby="prompt-heading-id" aria-describedby="prompt-message-wrapper" class="slds-modal slds-fade-in-open slds-modal--prompt">
          <div class="slds-modal__container">
            <div class="slds-modal__header slds-theme--shade globalPromptTitle">
              <h2 class="slds-text-heading--medium" id="prompt-heading-id">Registration Successful</h2>
            </div>
            <div class="slds-modal__content slds-p-around--medium">
                <p><center>Thank you for registering your product. <br/><br/> {!v.warrantyResult}</center></p>
            </div>
            <div class="slds-modal__footer slds-theme--default">
                <!--ui:button aura:id="successBtn" label="Register a New Product" press="{!c.goBackToSelection}"/-->
                <!--<a href="/myRyobi/s/my-tool-bag" class="slds-button slds-button-neutral">OK</a>-->
                <a href="{!v.siteSettings.My_Toolbag__c}" class="slds-button slds-button--neutral">OK</a>
            </div>
          </div>
        </div>
    	<div class="slds-backdrop slds-backdrop--open"></div>
    </div>
    <div id="mainDetailDiv" style=" display: none;" >
   	 <div class="globalBox2">
     	<div class="slds-text-heading--medium globalProductTitle">
            Enter your product details
            
        </div>
        <div >
          
                        
        </div>
        <div class="globalBoxInner">
        <div id="productDetailDiv" style="display: none;">
            <!--PRODUCT DETAIL-->    
            <div class="slds-grid slds-wrap">
                <div>
                    <div class="slds-text-align--center">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-p-horizontal--small slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                <span class="slds-image slds-image--card productKitImage">
                                  <img src="{!v.assetImageURL}"
                                       alt="{!v.asset.Name}" />
                                </span>
                            </div>
                            <div class="slds-text-align--left slds-p-left--medium slds-size--1-of-1 slds-medium-size--2-of-3 slds-large-size--2-of-3">
                                <div>
                                    <div class="productKitTitle slds-text-heading--medium ">{!v.asset.Name}</div>
                                    <div class="productKitModel slds-text-body--regular">MODEL# {!v.assetProductCode}</div>
                               		
                                </div>
                                <div class="slds-small-size--3-of-3 slds-medium-size--3-of-3 slds-large-size--3-of-3 slds-form--stacked slds-m-top--large ">
                                  <div class="slds-form-element inputWidth">
                                    <label class="slds-form-element__label" for="purchaseDateP">* Date of Purchase: </label>
                                    <div class="slds-form-element__control">
                                        <ui:inputDate aura:id="purchaseDateP" class="slds-input" value="{!v.purchaseDateP}" displayDatePicker="true" required="true"/>
                                    </div>
                                  </div>
                                    <!--div class="slds-form-element">
                                        <legend class="slds-form-element__legend slds-form-element__label">* Where was product purchased?</legend>
                                        <div class="slds-form-element__control">
                                                  <ui:inputRadio name="optionsP" label="Bunnings" change="{!c.onGroupP}"/>
                                                  <ui:inputRadio name="optionsP" label="Others" change="{!c.onGroupP}"/>
                                                  <ui:inputtext aura:id="otherLocP" class="slds-input" placeholder="other location" value="{!v.locationHolderP}" disabled="true"/>
                                        </div>
                                    </div-->
                                  <div class="slds-form-element">
                                    <label class="slds-form-element__label" for="location">Where was product purchased? </label>
                                    <div class="slds-form-element__control slds-size-1-of-1 inputWidth">
                                        <!--ui:inputSelect aura:id="locationSelectP" value="{!v.locationP}"  change="{!c.onGroupP}"-->
										<ui:inputSelect aura:id="locationSelectP" value="{!v.locationP}" class="inputWidth" >
                                            <aura:iteration items="{!v.locationList}" var="location">
                                                <ui.inputSelectOption text="{!location}" label="{!location}"/>	
                                            </aura:iteration>
                                        </ui:inputSelect>
                                        <aura:if isTrue="{!v.locationP == 'Others'}">
                                        	<ui:inputtext aura:id="otherLocP" class="slds-input" placeholder="Please specify" value="{!v.locationHolderP}"/>
                                        </aura:if>
                                         
                                    </div>
                                  </div>
                                 <div class="slds-form-element slds-m-top--medium"> 
                                     <img src="http://www.iconsdb.com/icons/preview/gray/info-2-xxl.png" height="20" width="20"></img>
                                  	 <label class="slds-form-element__label"  style="padding-left: 5px; padding-right: 5px;" for="serialNoP">{!v.asset.HelpText__c}</label>
                                 </div>
                                 <div class="slds-form-element slds-clearfix" style="width:100%">
                                                                      

                                     <div class="slds-float--left"> 
                                   	 	<label class="slds-form-element__label" for="serialNoP">* Serial #: </label>
                                    	<div>
                                        	<ui:inputText aura:id="serialNoP" class="slds-input inputWidth" placeholder="" value="{!v.serialNoP}" maxlength="{!v.asset.Serial_Number_Length__c}"/>
                                   		    <!--input  id="serialNoP" class="slds-input inputWidth" placeholder="" value="{!v.serialNoP}" size="{!v.serialNumberLength}" maxlength="{!v.serialNumberLength}" /-->

                                         </div>
                                     </div>
                                       
                                     <aura:if isTrue="{!v.asset.Display_Week__c}">
                                    	<div class="slds-float--left" style="padding-left: 5px; padding-right: 5px;">
                                        	<label class="slds-form-element__label" for="serialNoP">Week:</label>
                                            <div>
                                            	<ui:inputText aura:id="serialWeek" class="slds-input inputWidthWeek" placeholder="" value="{!v.serialWeek}" maxlength="2"/>
                                            </div>
                                         </div>
                                    </aura:if>
                                    <aura:if isTrue="{!v.asset.Display_Year__c}">
                                   		<div class="slds-float--left">
                                         	<label class="slds-form-element__label" for="serialNoP">Year:</label>
                                         	<div>
                                            	<ui:inputText aura:id="serialYear" class="slds-input inputWidthYear" placeholder="" value="{!v.serialYear}" maxlength="4"/>
                                            </div>
                                        </div>  	
                                     </aura:if>
                                    </div>
                                         <div style="padding: 5px;">
                                            <img src="{!v.asset.Helper_Image_URL__c}"></img>
                                         </div>                                       
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="kitDetailDiv" style="display: none;">
    		<!--KIT DETAIL-->
            <div class="slds-grid slds-wrap" >
                <div>
                    <div class="slds-text-align--center">
                        <div class="slds-grid slds-wrap">
                            <div class="slds-p-horizontal--small slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                <span class="slds-image slds-image--card productKitImage">
                                  <img src="{!v.assetImageURL}"
                                       alt="{!v.asset.Name}" />
                                </span>
                            </div>
                            <div class="slds-text-align--left slds-p-left--medium slds-size--1-of-1 slds-medium-size--2-of-3 slds-large-size--2-of-3" >
                                <div>
                                    <div class="productKitTitle slds-text-heading--medium ">{!v.asset.Name}</div>
                                    <div class="productKitModel slds-text-body--regular">MODEL# {!v.asset.ProductCode}</div>
                                </div>
                                <div class="slds-small-size--3-of-3 slds-medium-size--2-of-3 slds-large-size--1-of-3 slds-form--stacked slds-m-top--large ">
                                  <div class="slds-form-element">
                                    <label class="slds-form-element__label" for="purchaseDateK">* Date of Purchase: </label>
                                    <div class="slds-form-element__control">
                                    	<ui:inputDate aura:id="purchaseDateK" class="slds-input" value="{!v.purchaseDateK}" displayDatePicker="true" />
                                    </div>
                                  </div>
                                    
                                  <div class="slds-form-element">
                                    <label class="slds-form-element__label" for="location">* Where was product purchased? </label>
                                    <div class="slds-form-element__control">
                                        <!--ui:inputSelect aura:id="locationSelectK" value="{!v.locationK}" change="{!c.onGroupK}"-->
                                        <ui:inputSelect aura:id="locationSelectK" value="{!v.locationK}">
                                        	<aura:iteration items="{!v.locationList}" var="location">
                                                <ui.inputSelectOption text="{!location}" label="{!location}"/>
                                            </aura:iteration>
                                        </ui:inputSelect>
                                        <aura:if isTrue="{!v.locationK == 'Others'}">
                                        	<ui:inputtext aura:id="otherLocK" class="slds-input" placeholder="Please specify" value="{!v.locationHolderK}"/>
                                        </aura:if>
                                    </div>
                                  </div>
                                </div>
                            </div>
        					<div class="whitespace slds-size--1-of-1"></div> 
                            <div class="slds-size--1-of-1 slds-text-heading--small slds-text-align--left" style="font-weight:Â bold;" > Registration Details:</div> 
                            <div class="slds-grid slds-grid--pull-padded slds-wrap">
                                
                            <aura:iteration items="{!v.individualAssetList}" var="tool">                                
                                <div class="slds-grid slds-p-around--small slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1"> 
                                    <div class="productImage slds-float--left slds-align--absolute-center slds-image slds-image--card .slds-image__crop--1x1 slds-size--1-of-2 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                        <img src="{!tool.Image_URL__c}" />
                                    </div>
                                    <div class="slds-wrap slds-size--1-of-2 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                        <div class="productTitle slds-text-body--regular">{!tool.Name}</div>
                                        <div class="productKitModel slds-text-body--regular">{!tool.ProductCode}</div>
                                    </div>
                                    <div class="slds-align--absolute-center slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                        <div class="slds-clearfix" style="width:100%"> 
                                            <div class="slds-float--left" style="text-align:left;">
                                                <label class="slds-form-element__label">* Serial#: </label>
                                                <div>
                                                    <ui:inputText class="slds-input" value="{!tool.SerialNumber}" maxlength="{!tool.Serial_Number_Length__c}"/>
                                                </div>
                                            </div>
                                            <aura:if isTrue="{!tool.Display_Week__c}">
                                                <div class="slds-float--left" style="padding-left: 5px; padding-right: 5px;">
                                                    <label class="slds-form-element__label" >Week:</label>
                                                    <div>
                                                        <ui:inputText aura:id="serialWeek" class="slds-input inputWidthWeek" placeholder="" value="{!tool.SerialNumberWeek__c}" maxlength="2"/>
                                                    </div>
                                                </div>
                                            </aura:if>
                                            <aura:if isTrue="{!tool.Display_Year__c}">
                                                <div class="slds-float--left">
                                                    <label class="slds-form-element__label" for="serialNoP">Year:</label>
                                                    <div>
                                                        <ui:inputText aura:id="serialYear" class="slds-input inputWidthYear" placeholder="" value="{!tool.SerialNumberYear__c}" maxlength="4"/>
                                                    </div>
                                                </div>  	
                                        	 </aura:if>
                                        </div>
                                    </div>                                   
                            	</div>
                            </aura:iteration>
                               
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             <div class="">
             	<img src="{!$Resource.CommunitySerialHelper}"></img>
                 
            	</div>
           </div>
            
         </div><!-- enclosing -->   
        </div>
        <div class="whitespace slds-size--1-of-1"/>
        <div class="globalBox2">
             <div class="slds-text-heading--medium globalProductTitle">
            	Upload Receipt         
       	 	</div> 
            <div class="globalBoxInner">
             <div class="slds-text-body--regular" >
             
                 	<p>
                            <!--
                            Ensure that you have a digital copy a of your full original Bunnings receipt 
                            (eg. you could take a photo with your phone or scan a copy via a multifunction printer) 
                            and the receipt is legible. Receipts that are only half scanned or illegible may be rejected.
                        -->
                       		Upload receipt as image or pdf. Date of purchase, location and model number must be clearly visible. 
                            For long receipts fold the receipt to display your RYOBI tool

						</p>
                    </div>
					<div class="slds-form-element slds-m-top--medium">
                            <label class="slds-form-element__label" for="location">Is this a Bunnings receipt? </label>
                            <div class="slds-form-element__control">
                                <p>
                                    <ui:inputSelect aura:id="isBunningReceipt" value="{!v.isBunningReceipt}" class="width30p">
                                        <ui.inputSelectOption text="Yes" label="Yes" value="true"/>
                                        <ui.inputSelectOption text="No" label="No" value="false"/>
                                    </ui:inputSelect>
                                </p>
                            </div>
                   	</div>
            <div class="slds-m-bottom--small slds-m-top--medium">
                <div class="slds-grid slds-wrap">
                    <div class="slds-size--1-of-1">
                        <label class="slds-form-element__label" for="location">* Click here to upload a receipt: </label>
                            
                        <div class="container">
                            <input type="file" class="file" aura:id="file" onchange="{!c.fileUploaded}"/>
                            
                        </div>
                        <div>
                            <img id="receiptView" src="#" alt="receipt image" hidden="true" style="height:500px;width:500px;"/>
                        </div>
                        
                    </div>
                   
                </div>
            </div>
            </div>
        </div>
        <div class="slds-size--1-of-1 slds-align--absolute-center">
            <div aura:id="uploading" class="notUploading">
            	<img src="{!$Resource.LoadingSpinner}" alt="uploading" class="slds-avatar slds-avatar--large" /> Uploading...
            </div>
        </div>
         <div class="slds-size--1-of-1 slds-align--absolute-center">

             <!--div aura:id="errorDiv" class="globalerrordisplay"--><!--/div-->
            <aura:renderIf isTrue="{!v.showError}">
                    <div class="globalerrordisplay">
                        <ui:outputRichText value="{!v.errorMessage}"/>
                    </div>
            </aura:renderIf>

        </div>

        <div class="slds-wrap slds-size--1-of-1 slds-align--absolute-center ">
  			<ui:button aura:id="backBtn" label="Modify" press="{!c.goBackToSelection}" class="globalButton"/>
            <ui:button aura:id="confirmBtn" label="Register" press="{!c.confirmAddMore}" class="globalProductItemButton"/>
            
            <!--<lightning:button name="confirmBtn" class="globalButton" label="Register" onclick="{!c.confirmAddMore}" />-->
            <!--lightning:button class="globalButton" label="Modify" onclick="{! c.goBackToSelection }" ></lightning:button-->
         </div>

    </div>
    
    
<!-- / FOOTER -->
</aura:component>