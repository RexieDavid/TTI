<!-- This component is created by Upendra Kumar -->
<!-- This component will handle all the functionality of file upload and view in claim page in portal -->
<aura:component controller="TTI_FileViewAndUploadController"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" access="global" >
    <aura:attribute name="recordId" 
                    type="String"
                    description="Record to which the files should be attached" />
    <aura:attribute name="Service_Request_Case" type="Case"/>
    <aura:attribute name="listOfFiles" 
                    type="ContentDocumentLink[]"/>
    <aura:attribute name="showSpinnerBlock" 
                    type="boolean"
                    default="false"/>
    <aura:attribute name="isFileAttached" 
                    type="boolean"
                    default="false"/>
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <fieldset class="slds-m-top_medium">
        <legend class="slds-form-element__label slds-text-heading_medium slds-m-top_medium 
                       slds-m-bottom_medium" 
                onclick="{!c.toggleSection}"
                style="background:#f9f9fa;cursor:pointer;width:100%">
            <div class="slds-float--left ">
                <lightning:icon class="slds-hide" aura:id="section" iconName="utility:chevronright" size="x-small" alternativeText="Indicates add"/>
                <lightning:icon aura:id="section" iconName="utility:chevrondown" size="x-small" alternativeText="Indicates dash"/>
            </div>
            <span class="slds-m-left_medium">
                <b><u>Claim Receipt Details</u></b>
            </span>
        </legend>
        <div aura:id="section" class="slds-show slds-form-element__group">
            <aura:if isTrue="{!v.showSpinnerBlock}">
                <center>
                    <div class="slds-spinner_container" aura:id="spinner">
                        <div class="slds-spinner slds-spinner_brand slds-spinner--large" role="alert">
                            <span class="slds-assistive-text "></span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </div>
                </center>
            </aura:if>
            <table class="slds-table slds-table_bordered" >
                <thead>
                    <tr>
                        <th colspan="2" style="text-align: center;">
                            <lightning:fileUpload class="hidelabel"
                                                  label="" 
                                                  multiple="true" 
                                                  accept=".pdf, .png, .jpg, .docx. .gif, .jpeg, .xls, .xlsx"
                                                  recordId="{!v.recordId}" 
                                                  onuploadfinished="{!c.handleUploadFinished}"
                                                  />
                        </th>
                    </tr>
                    <tr class="slds-text-title_caps" >
                        <th scope="col" style="background: #c9c9ca;">
                            <div class="slds-truncate" title="File Name"><b>File Name</b></div>
                        </th>
                        <th scope="col" class="slds-text-align_right" style="background: #c9c9ca;">
                            <div class="slds-truncate" title="Action"><b>Action</b></div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <aura:iteration items="{!v.listOfFiles}" var="file" indexVar="rowIndex">
                        <tr>
                            <td class="slds-truncate slds-wrap">
                                <span class="slds-truncate slds-wrap">{!file.ContentDocument.Title}.{!file.ContentDocument.FileExtension}</span>
                            </td>
                            <td class="slds-truncate slds-wrap slds-text-align_right">
                                    <a name="Preview"
                                       href="{!$Label.c.Service_Portal_Base_URL + '/services/apexrest/fileView?id=' + file.ContentDocument.Id + 'type' + file.ContentDocument.FileExtension}"
                                       target="_blank"
                                       >
                                        <lightning:icon iconName="utility:preview" size="small" alternativeText="Preview"/>
                                    </a>
                                <button data-value="{!rowIndex}" class="slds-button slds-button_icon " title="Remove" onclick="{!c.removeDocument}">
                                    <lightning:icon iconName="utility:delete" size="small" alternativeText="Remove"/>
                                </button>
                            </td>
                        </tr>
                    </aura:iteration>
                </tbody>
            </table>
        </div>
    </fieldset>
</aura:component>